###################################
# FP3 Maintenance Events
# By Ewan Cowhig Croft
###################################

scripted_trigger fp3_struggle_0001_valid_ai_struggle_char_trigger = {
	# Basic checks.
	can_execute_decision = fp3_name_read_in_friday_prayer_decision
	is_ai = yes
	# Suitability for switchin' checks.
	OR = {
		# If they're gonna to submit to the empire, it should make sense.
		AND = {
			opinion = {
				target = title:e_spain.holder
				value >= low_positive_opinion
			}
			OR = {
				# We check for the opposite, since you're flipflopping.
				has_trait = s_empire_struggle_disloyal
				NOR = {
					has_trait = s_empire_struggle_loyal
					has_trait = s_empire_struggle_disloyal
				}
			}
		}
		# If they're gonna to oppose the empire, that should make sense too.
		AND = {
			opinion = {
				target = title:e_spain.holder
				value <= low_negative_opinion
			}
			OR = {
				# We check for the opposite, since you're flipflopping.
				has_trait = s_empire_struggle_loyal
				NOR = {
					has_trait = s_empire_struggle_loyal
					has_trait = s_empire_struggle_disloyal
				}
			}
		}
	}
}

fp3_struggle.0001 = {
	hidden = yes
	scope = none
	scope = struggle

	# If the struggle ends, break the loop.
	trigger = { exists = struggle:persian_struggle }

	immediate = {
		if = {
			# If there isn't a caliph at present, then stop trying to make people talk about them.
			limit = { exists = title:d_sunni.holder }
			struggle:persian_struggle = {
				every_involved_ruler = {
					limit = { fp3_struggle_0001_valid_ai_struggle_char_trigger = yes }
					random = {
						chance = fp3_struggle_switch_sides_value
						execute_decision = fp3_name_read_in_friday_prayer_decision
					}
				}
				every_interloper_ruler = {
					limit = { fp3_struggle_0001_valid_ai_struggle_char_trigger = yes }
					random = {
						chance = fp3_struggle_switch_sides_value
						execute_decision = fp3_name_read_in_friday_prayer_decision
					}
				}
			}
		}
	}

	after = {
		# Cue this event up again for the next time around.
		trigger_event = {
			id = fp3_struggle.0001
			years = { 3 5 }
		}
	}
}